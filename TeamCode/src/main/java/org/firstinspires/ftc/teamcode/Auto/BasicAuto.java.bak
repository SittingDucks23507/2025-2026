package org.firstinspires.ftc.teamcode.Auto;

import static com.qualcomm.robotcore.hardware.DcMotorSimple.Direction.REVERSE;

import com.qualcomm.robotcore.eventloop.opmode.Autonomous;
import com.qualcomm.robotcore.eventloop.opmode.LinearOpMode;
import com.qualcomm.robotcore.hardware.CRServo;
import com.qualcomm.robotcore.hardware.DcMotor;
import com.qualcomm.robotcore.hardware.DcMotorEx;
import com.qualcomm.robotcore.util.ElapsedTime;

import org.firstinspires.ftc.teamcode.Config;

@Autonomous(name="THE Auto", group="Autos")
public class BasicAuto extends LinearOpMode {
    DcMotor spinny;
    DcMotorEx theCoolerSpinny;
    CRServo left_assist, right_assist;
    ElapsedTime finger = new ElapsedTime();
    @Override
    public void runOpMode() {
        float target = 0.0f;
        double spmul = 0.0;
        double ls = 1600.0;
        
        MechanumAuto Auto = new MechanumAuto();

        Auto.frontLeft = hardwareMap.get(DcMotor.class, "front_left");
        Auto.frontRight = hardwareMap.get(DcMotor.class, "front_right");
        Auto.backLeft = hardwareMap.get(DcMotor.class, "back_left");
        Auto.backRight = hardwareMap.get(DcMotor.class, "back_right");

        Auto.frontLeft.setDirection(REVERSE);
        Auto.backLeft.setDirection(REVERSE);

        Auto.frontRight.setZeroPowerBehavior(DcMotor.ZeroPowerBehavior.BRAKE);
        Auto.backRight.setZeroPowerBehavior(DcMotor.ZeroPowerBehavior.BRAKE);
        Auto.frontLeft.setZeroPowerBehavior(DcMotor.ZeroPowerBehavior.BRAKE);
        Auto.backLeft.setZeroPowerBehavior(DcMotor.ZeroPowerBehavior.BRAKE);
        spinny = hardwareMap.get(DcMotor.class, "spinny");
        theCoolerSpinny = (DcMotorEx)spinny;

        left_assist = hardwareMap.get(CRServo.class, "left_assist");
        right_assist = hardwareMap.get(CRServo.class, "right_assist");
        spinny.setDirection(REVERSE);
        right_assist.setDirection(REVERSE);
        Auto.lop = this;
        waitForStart();
        finger.reset();
        spinny.setPower(Config.spinny_speed*spmul);
        Auto.movetime(1, Auto.DOWN);
        /*
        target += 3.0f;
        while (finger.seconds() < target) {
            telemetry.addData("spinny is spinning", finger.seconds());
            telemetry.update();
        }
        */
        // three balls
        // math
        for (int i = 0; i < 3; i++) {
            // TODO: move 0.3f to Config.java
            while (!(Math.abs(theCoolerSpinny.getVelocity()) > (ls-20) && Math.abs(theCoolerSpinny.getVelocity()) < (ls+20))) {
                if (Math.abs(theCoolerSpinny.getVelocity()) < ls) spmul += 0.05;
                if (Math.abs(theCoolerSpinny.getVelocity()) > ls) spmul -= 0.05;
                // if (Math.abs(theCoolerSpinny.getVelocity()) == ls) spmul = 0.0;
                spinny.setPower(spmul);
                target += 0.3;
                while (finger.seconds() < target) {
                    telemetry.addData("spinny tps", theCoolerSpinny.getVelocity());
                    telemetry.addData("spmul", spmul);
                    telemetry.update();
                }
            }

            finger.reset();
            target = 0.0f;

            left_assist.setPower(0.3f);
            right_assist.setPower(0.3f);
            target += 1.0f;
            while (finger.seconds() < target) {
                telemetry.addData("assist time", finger.seconds());
                telemetry.update();
            }
            left_assist.setPower(0.0f);
            right_assist.setPower(0.0f);
            target += 1.0f; // no idea
            while (finger.seconds() < target) {
                telemetry.addData("patience", finger.seconds());
                telemetry.update();
            }
        }
    }
}